{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.219.0"},"children":{"MosaicLifeStack":{"id":"MosaicLifeStack","path":"MosaicLifeStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.219.0"},"children":{"MosaicVPC":{"id":"MosaicVPC","path":"MosaicLifeStack/MosaicVPC","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]},"children":{"PublicSubnet1":{"id":"PublicSubnet1","path":"MosaicLifeStack/MosaicVPC/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"PublicSubnet2":{"id":"PublicSubnet2","path":"MosaicLifeStack/MosaicVPC/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"PublicSubnet3":{"id":"PublicSubnet3","path":"MosaicLifeStack/MosaicVPC/PublicSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"PrivateSubnet1":{"id":"PrivateSubnet1","path":"MosaicLifeStack/MosaicVPC/PrivateSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"PrivateSubnet2":{"id":"PrivateSubnet2","path":"MosaicLifeStack/MosaicVPC/PrivateSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"PrivateSubnet3":{"id":"PrivateSubnet3","path":"MosaicLifeStack/MosaicVPC/PrivateSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}}}},"HostedZone":{"id":"HostedZone","path":"MosaicLifeStack/HostedZone","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Certificate":{"id":"Certificate","path":"MosaicLifeStack/Certificate","constructInfo":{"fqn":"aws-cdk-lib.aws_certificatemanager.Certificate","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/Certificate/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_certificatemanager.CfnCertificate","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CertificateManager::Certificate","aws:cdk:cloudformation:props":{"domainName":"mosaiclife.me","domainValidationOptions":[{"domainName":"mosaiclife.me","hostedZoneId":"Z039487930F6987CJO4W9"},{"domainName":"frontend.mosaiclife.me","hostedZoneId":"Z039487930F6987CJO4W9"},{"domainName":"backend.mosaiclife.me","hostedZoneId":"Z039487930F6987CJO4W9"},{"domainName":"graph.mosaiclife.me","hostedZoneId":"Z039487930F6987CJO4W9"},{"domainName":"chat.mosaiclife.me","hostedZoneId":"Z039487930F6987CJO4W9"}],"subjectAlternativeNames":["*.mosaiclife.me","frontend.mosaiclife.me","backend.mosaiclife.me","graph.mosaiclife.me","chat.mosaiclife.me"],"tags":[{"key":"Name","value":"MosaicLifeStack/Certificate"}],"validationMethod":"DNS"}}}}},"UserPool":{"id":"UserPool","path":"MosaicLifeStack/UserPool","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]},"children":{"CognitoDomain":{"id":"CognitoDomain","path":"MosaicLifeStack/UserPool/CognitoDomain","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.UserPoolDomain","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/UserPool/CognitoDomain/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.CfnUserPoolDomain","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Cognito::UserPoolDomain","aws:cdk:cloudformation:props":{"domain":"mosaic-prod-033691785857","userPoolId":"us-east-1_JLppKC09m"}}}}},"WebAppClient":{"id":"WebAppClient","path":"MosaicLifeStack/UserPool/WebAppClient","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.UserPoolClient","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/UserPool/WebAppClient/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.CfnUserPoolClient","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Cognito::UserPoolClient","aws:cdk:cloudformation:props":{"accessTokenValidity":60,"allowedOAuthFlows":["code"],"allowedOAuthFlowsUserPoolClient":true,"allowedOAuthScopes":["email","openid","profile"],"callbackUrLs":["https://mosaiclife.me/auth/callback","https://frontend.mosaiclife.me/auth/callback","http://localhost:5173/auth/callback"],"clientName":"mosaic-web-client","enableTokenRevocation":true,"explicitAuthFlows":["ALLOW_USER_PASSWORD_AUTH","ALLOW_CUSTOM_AUTH","ALLOW_USER_SRP_AUTH","ALLOW_REFRESH_TOKEN_AUTH"],"generateSecret":true,"idTokenValidity":60,"logoutUrLs":["https://mosaiclife.me","https://frontend.mosaiclife.me","http://localhost:5173"],"preventUserExistenceErrors":"ENABLED","refreshTokenValidity":43200,"supportedIdentityProviders":["COGNITO"],"tokenValidityUnits":{"idToken":"minutes","accessToken":"minutes","refreshToken":"minutes"},"userPoolId":"us-east-1_JLppKC09m"}}}}}}},"GoogleProvider":{"id":"GoogleProvider","path":"MosaicLifeStack/GoogleProvider","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.UserPoolIdentityProviderGoogle","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/GoogleProvider/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.CfnUserPoolIdentityProvider","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Cognito::UserPoolIdentityProvider","aws:cdk:cloudformation:props":{"attributeMapping":{"email":"email","given_name":"given_name","family_name":"family_name"},"providerDetails":{"client_id":"REPLACE_WITH_GOOGLE_CLIENT_ID","client_secret":"REPLACE_WITH_GOOGLE_CLIENT_SECRET","authorize_scopes":"profile email openid"},"providerName":"Google","providerType":"Google","userPoolId":"us-east-1_JLppKC09m"}}}}},"GitHubProvider":{"id":"GitHubProvider","path":"MosaicLifeStack/GitHubProvider","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.UserPoolIdentityProviderOidc","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/GitHubProvider/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cognito.CfnUserPoolIdentityProvider","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Cognito::UserPoolIdentityProvider","aws:cdk:cloudformation:props":{"attributeMapping":{"email":"email","given_name":"name"},"providerDetails":{"client_id":"REPLACE_WITH_GITHUB_CLIENT_ID","client_secret":"REPLACE_WITH_GITHUB_CLIENT_SECRET","authorize_scopes":"openid email profile","attributes_request_method":"GET","oidc_issuer":"https://token.actions.githubusercontent.com"},"providerName":"GitHub","providerType":"OIDC","userPoolId":"us-east-1_JLppKC09m"}}}}},"CognitoConfig":{"id":"CognitoConfig","path":"MosaicLifeStack/CognitoConfig","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.Secret","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/CognitoConfig/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.CfnSecret","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SecretsManager::Secret","aws:cdk:cloudformation:props":{"description":"Cognito configuration for Mosaic Life","name":"mosaic/prod/cognito-config","secretString":{"Fn::Join":["",["{\"userPoolId\":\"us-east-1_JLppKC09m\",\"userPoolClientId\":\"",{"Ref":"UserPoolWebAppClientCD2D5CB1"},"\",\"userPoolDomain\":\"",{"Ref":"UserPoolCognitoDomainD6C7F9FA"},"\",\"region\":\"us-east-1\"}"]]}}}}}},"SessionSecret":{"id":"SessionSecret","path":"MosaicLifeStack/SessionSecret","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.Secret","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/SessionSecret/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.CfnSecret","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SecretsManager::Secret","aws:cdk:cloudformation:props":{"description":"Session secret key for authentication","generateSecretString":{"secretStringTemplate":"{}","generateStringKey":"secret-key","excludePunctuation":true,"passwordLength":64},"name":"mosaic/prod/session/secret-key","tags":[{"key":"Component","value":"Security"},{"key":"Environment","value":"prod"}]}}}}},"MediaBucket":{"id":"MediaBucket","path":"MosaicLifeStack/MediaBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.219.0","metadata":[]}},"MediaBucketCors":{"id":"MediaBucketCors","path":"MosaicLifeStack/MediaBucketCors","constructInfo":{"fqn":"aws-cdk-lib.custom_resources.AwsCustomResource","version":"2.219.0"},"children":{"Provider":{"id":"Provider","path":"MosaicLifeStack/MediaBucketCors/Provider","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.SingletonFunction","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"MosaicLifeStack/MediaBucketCors/Resource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.219.0","metadata":[]},"children":{"Default":{"id":"Default","path":"MosaicLifeStack/MediaBucketCors/Resource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}}}},"CustomResourcePolicy":{"id":"CustomResourcePolicy","path":"MosaicLifeStack/MediaBucketCors/CustomResourcePolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/MediaBucketCors/CustomResourcePolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"s3:PutBucketCors","Effect":"Allow","Resource":"arn:aws:s3:::mosaic-prod-media-033691785857"}],"Version":"2012-10-17"},"policyName":"MediaBucketCorsCustomResourcePolicyD6C0ADA2","roles":[{"Ref":"AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2"}]}}}}}}},"AWS679f53fac002430cb0da5b7982bd2287":{"id":"AWS679f53fac002430cb0da5b7982bd2287","path":"MosaicLifeStack/AWS679f53fac002430cb0da5b7982bd2287","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.219.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"MosaicLifeStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"MosaicLifeStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"MosaicLifeStack/AWS679f53fac002430cb0da5b7982bd2287/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}}}},"Code":{"id":"Code","path":"MosaicLifeStack/AWS679f53fac002430cb0da5b7982bd2287/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.219.0"},"children":{"Stage":{"id":"Stage","path":"MosaicLifeStack/AWS679f53fac002430cb0da5b7982bd2287/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.219.0"}},"AssetBucket":{"id":"AssetBucket","path":"MosaicLifeStack/AWS679f53fac002430cb0da5b7982bd2287/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.219.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"MosaicLifeStack/AWS679f53fac002430cb0da5b7982bd2287/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-033691785857-us-east-1","s3Key":"34a66902956b031404ef497526f619b900363fe7fd65ff02b1de4c30fe10c034.zip"},"handler":"index.handler","role":{"Fn::GetAtt":["AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2","Arn"]},"runtime":"nodejs22.x","timeout":120}}}}},"BackupBucket":{"id":"BackupBucket","path":"MosaicLifeStack/BackupBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.219.0","metadata":[]}},"webRepository":{"id":"webRepository","path":"MosaicLifeStack/webRepository","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.RepositoryBase","version":"2.219.0","metadata":[]}},"coreApiRepository":{"id":"coreApiRepository","path":"MosaicLifeStack/coreApiRepository","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.RepositoryBase","version":"2.219.0","metadata":[]}},"docsRepository":{"id":"docsRepository","path":"MosaicLifeStack/docsRepository","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.RepositoryBase","version":"2.219.0","metadata":[]}},"DomainEventsTopic":{"id":"DomainEventsTopic","path":"MosaicLifeStack/DomainEventsTopic","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/DomainEventsTopic/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{"displayName":"Mosaic Life Domain Events","topicName":"mosaic-prod-domain-events"}}}}},"EventsDLQ":{"id":"EventsDLQ","path":"MosaicLifeStack/EventsDLQ","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/EventsDLQ/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"messageRetentionPeriod":1209600,"queueName":"mosaic-prod-events-dlq"}}}}},"EventsQueue":{"id":"EventsQueue","path":"MosaicLifeStack/EventsQueue","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/EventsQueue/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"queueName":"mosaic-prod-events","redrivePolicy":{"deadLetterTargetArn":{"Fn::GetAtt":["EventsDLQ3D9C0575","Arn"]},"maxReceiveCount":3},"visibilityTimeout":300}}},"Policy":{"id":"Policy","path":"MosaicLifeStack/EventsQueue/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.QueuePolicy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/EventsQueue/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueuePolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::QueuePolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"sqs:SendMessage","Condition":{"ArnEquals":{"aws:SourceArn":{"Ref":"DomainEventsTopic9EECFB64"}}},"Effect":"Allow","Principal":{"Service":"sns.amazonaws.com"},"Resource":{"Fn::GetAtt":["EventsQueueB96EB0D2","Arn"]}}],"Version":"2012-10-17"},"queues":[{"Ref":"EventsQueueB96EB0D2"}]}}}}},"MosaicLifeStackDomainEventsTopic693AF0EA":{"id":"MosaicLifeStackDomainEventsTopic693AF0EA","path":"MosaicLifeStack/EventsQueue/MosaicLifeStackDomainEventsTopic693AF0EA","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Subscription","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/EventsQueue/MosaicLifeStackDomainEventsTopic693AF0EA/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnSubscription","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Subscription","aws:cdk:cloudformation:props":{"endpoint":{"Fn::GetAtt":["EventsQueueB96EB0D2","Arn"]},"protocol":"sqs","topicArn":{"Ref":"DomainEventsTopic9EECFB64"}}}}}}}},"CoreApiRole":{"id":"CoreApiRole","path":"MosaicLifeStack/CoreApiRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportCoreApiRole":{"id":"ImportCoreApiRole","path":"MosaicLifeStack/CoreApiRole/ImportCoreApiRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"MosaicLifeStack/CoreApiRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRoleWithWebIdentity","Condition":{"StringEquals":{"oidc.eks.us-east-1.amazonaws.com/id/D491975E1999961E7BBAAE1A77332FBA:aud":"sts.amazonaws.com"},"StringLike":{"oidc.eks.us-east-1.amazonaws.com/id/D491975E1999961E7BBAAE1A77332FBA:sub":["system:serviceaccount:mosaic-prod:core-api","system:serviceaccount:preview-*:core-api"]}},"Effect":"Allow","Principal":{"Federated":"arn:aws:iam::033691785857:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/D491975E1999961E7BBAAE1A77332FBA"}}],"Version":"2012-10-17"},"description":"IAM role for core-api service in EKS (includes preview environments)","roleName":"mosaic-prod-core-api-role"}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MosaicLifeStack/CoreApiRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicLifeStack/CoreApiRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:Abort*","s3:DeleteObject*","s3:GetBucket*","s3:GetObject*","s3:List*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":["arn:aws:s3:::mosaic-prod-backups-033691785857","arn:aws:s3:::mosaic-prod-backups-033691785857/*","arn:aws:s3:::mosaic-prod-media-033691785857","arn:aws:s3:::mosaic-prod-media-033691785857/*"]},{"Action":["secretsmanager:DescribeSecret","secretsmanager:GetSecretValue"],"Effect":"Allow","Resource":{"Ref":"CognitoConfig0041A066"}},{"Action":"sns:Publish","Effect":"Allow","Resource":{"Ref":"DomainEventsTopic9EECFB64"}},{"Action":["sqs:ChangeMessageVisibility","sqs:DeleteMessage","sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:ReceiveMessage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["EventsQueueB96EB0D2","Arn"]}},{"Action":["bedrock:InvokeModel","bedrock:InvokeModelWithResponseStream"],"Effect":"Allow","Resource":["arn:aws:bedrock:us-east-1:033691785857:inference-profile/us.anthropic.*","arn:aws:bedrock:us-east-1::foundation-model/anthropic.*","arn:aws:bedrock:us-east-2:033691785857:inference-profile/us.anthropic.*","arn:aws:bedrock:us-east-2::foundation-model/anthropic.*","arn:aws:bedrock:us-west-2:033691785857:inference-profile/us.anthropic.*","arn:aws:bedrock:us-west-2::foundation-model/anthropic.*"],"Sid":"AllowBedrockInvoke"}],"Version":"2012-10-17"},"policyName":"CoreApiRoleDefaultPolicy532B5FA2","roles":[{"Ref":"CoreApiRoleFD696CAE"}]}}}}}}},"VpcId":{"id":"VpcId","path":"MosaicLifeStack/VpcId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"CertificateArn":{"id":"CertificateArn","path":"MosaicLifeStack/CertificateArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"UserPoolId":{"id":"UserPoolId","path":"MosaicLifeStack/UserPoolId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"UserPoolClientId":{"id":"UserPoolClientId","path":"MosaicLifeStack/UserPoolClientId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"UserPoolDomain":{"id":"UserPoolDomain","path":"MosaicLifeStack/UserPoolDomain","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"MediaBucketName":{"id":"MediaBucketName","path":"MosaicLifeStack/MediaBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"DomainEventsTopicArn":{"id":"DomainEventsTopicArn","path":"MosaicLifeStack/DomainEventsTopicArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"HostedZoneId":{"id":"HostedZoneId","path":"MosaicLifeStack/HostedZoneId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"webRepositoryUri":{"id":"webRepositoryUri","path":"MosaicLifeStack/webRepositoryUri","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"coreApiRepositoryUri":{"id":"coreApiRepositoryUri","path":"MosaicLifeStack/coreApiRepositoryUri","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"docsRepositoryUri":{"id":"docsRepositoryUri","path":"MosaicLifeStack/docsRepositoryUri","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"MosaicLifeStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"MosaicLifeStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"MosaicLifeStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.219.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"MosaicLifeStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.219.0"}}}},"MosaicDatabaseStack":{"id":"MosaicDatabaseStack","path":"MosaicDatabaseStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.219.0"},"children":{"DatabaseSecurityGroup":{"id":"DatabaseSecurityGroup","path":"MosaicDatabaseStack/DatabaseSecurityGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicDatabaseStack/DatabaseSecurityGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"Security group for RDS PostgreSQL instance","groupName":"mosaic-prod-rds-sg","securityGroupEgress":[{"cidrIp":"255.255.255.255/32","description":"Disallow all traffic","ipProtocol":"icmp","fromPort":252,"toPort":86}],"securityGroupIngress":[{"cidrIp":"10.20.0.0/16","ipProtocol":"tcp","fromPort":5432,"toPort":5432,"description":"Allow PostgreSQL traffic from VPC"}],"vpcId":"vpc-0cda4cc7432deca33"}}}}},"DatabaseSubnetGroup":{"id":"DatabaseSubnetGroup","path":"MosaicDatabaseStack/DatabaseSubnetGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_rds.SubnetGroup","version":"2.219.0","metadata":[]},"children":{"Default":{"id":"Default","path":"MosaicDatabaseStack/DatabaseSubnetGroup/Default","constructInfo":{"fqn":"aws-cdk-lib.aws_rds.CfnDBSubnetGroup","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::RDS::DBSubnetGroup","aws:cdk:cloudformation:props":{"dbSubnetGroupDescription":"Subnet group for RDS PostgreSQL","dbSubnetGroupName":"mosaic-prod-db-subnet-group","subnetIds":["subnet-07a61c97e2e16d91b","subnet-079dd0d7be41e96a5","subnet-01e6823eddd4a9a94"]}}}}},"DatabaseSecret":{"id":"DatabaseSecret","path":"MosaicDatabaseStack/DatabaseSecret","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.Secret","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicDatabaseStack/DatabaseSecret/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.CfnSecret","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SecretsManager::Secret","aws:cdk:cloudformation:props":{"description":"Master credentials for RDS PostgreSQL","generateSecretString":{"secretStringTemplate":"{\"username\":\"mosaicadmin\"}","generateStringKey":"password","excludePunctuation":true,"passwordLength":32,"requireEachIncludedType":true},"name":"mosaic/prod/rds/credentials"}}},"Attachment":{"id":"Attachment","path":"MosaicDatabaseStack/DatabaseSecret/Attachment","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.SecretTargetAttachment","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicDatabaseStack/DatabaseSecret/Attachment/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.CfnSecretTargetAttachment","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SecretsManager::SecretTargetAttachment","aws:cdk:cloudformation:props":{"secretId":{"Ref":"DatabaseSecret86DBB7B3"},"targetId":{"Ref":"DatabaseB269D8BB"},"targetType":"AWS::RDS::DBInstance"}}}}}}},"DatabaseParameterGroup":{"id":"DatabaseParameterGroup","path":"MosaicDatabaseStack/DatabaseParameterGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_rds.ParameterGroup","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicDatabaseStack/DatabaseParameterGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_rds.CfnDBParameterGroup","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::RDS::DBParameterGroup","aws:cdk:cloudformation:props":{"description":"Custom parameter group for Mosaic Life PostgreSQL","family":"postgres16","parameters":{"max_connections":"100","shared_buffers":"{DBInstanceClassMemory/4096}","effective_cache_size":"{DBInstanceClassMemory*3/4096}","maintenance_work_mem":"{DBInstanceClassMemory/16384}","work_mem":"{DBInstanceClassMemory/25600}","wal_buffers":"2048","checkpoint_completion_target":"0.9","random_page_cost":"1.1","effective_io_concurrency":"200","log_min_duration_statement":"1000","log_connections":"1","log_disconnections":"1","log_lock_waits":"1","idle_in_transaction_session_timeout":"300000","statement_timeout":"30000"}}}}}},"Database":{"id":"Database","path":"MosaicDatabaseStack/Database","constructInfo":{"fqn":"aws-cdk-lib.aws_rds.DatabaseInstance","version":"2.219.0","metadata":[]},"children":{"MonitoringRole":{"id":"MonitoringRole","path":"MosaicDatabaseStack/Database/MonitoringRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportMonitoringRole":{"id":"ImportMonitoringRole","path":"MosaicDatabaseStack/Database/MonitoringRole/ImportMonitoringRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"MosaicDatabaseStack/Database/MonitoringRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"monitoring.rds.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AmazonRDSEnhancedMonitoringRole"]]}]}}}}},"Resource":{"id":"Resource","path":"MosaicDatabaseStack/Database/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_rds.CfnDBInstance","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::RDS::DBInstance","aws:cdk:cloudformation:props":{"allocatedStorage":"20","autoMinorVersionUpgrade":true,"backupRetentionPeriod":7,"copyTagsToSnapshot":true,"dbInstanceClass":"db.t3.micro","dbInstanceIdentifier":"mosaic-prod-db","dbName":"mosaic","dbParameterGroupName":{"Ref":"DatabaseParameterGroupC9757D64"},"dbSubnetGroupName":{"Ref":"DatabaseSubnetGroup"},"deletionProtection":true,"enableCloudwatchLogsExports":["postgresql","upgrade"],"enablePerformanceInsights":false,"engine":"postgres","engineVersion":"16","masterUsername":{"Fn::Join":["",["{{resolve:secretsmanager:",{"Ref":"DatabaseSecret86DBB7B3"},":SecretString:username::}}"]]},"masterUserPassword":{"Fn::Join":["",["{{resolve:secretsmanager:",{"Ref":"DatabaseSecret86DBB7B3"},":SecretString:password::}}"]]},"maxAllocatedStorage":100,"monitoringInterval":60,"monitoringRoleArn":{"Fn::GetAtt":["DatabaseMonitoringRole576991DA","Arn"]},"multiAz":false,"port":"5432","preferredBackupWindow":"03:00-04:00","preferredMaintenanceWindow":"sun:04:00-sun:05:00","publiclyAccessible":false,"storageEncrypted":true,"storageType":"gp3","vpcSecurityGroups":[{"Fn::GetAtt":["DatabaseSecurityGroup7319C0F6","GroupId"]}]}}},"LogRetentionpostgresql":{"id":"LogRetentionpostgresql","path":"MosaicDatabaseStack/Database/LogRetentionpostgresql","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogRetention","version":"2.219.0"},"children":{"Resource":{"id":"Resource","path":"MosaicDatabaseStack/Database/LogRetentionpostgresql/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}}}},"LogGroup${Token[TOKEN.237]}postgresql":{"id":"LogGroup${Token[TOKEN.237]}postgresql","path":"MosaicDatabaseStack/Database/LogGroup${Token[TOKEN.237]}postgresql","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"LogRetentionupgrade":{"id":"LogRetentionupgrade","path":"MosaicDatabaseStack/Database/LogRetentionupgrade","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogRetention","version":"2.219.0"},"children":{"Resource":{"id":"Resource","path":"MosaicDatabaseStack/Database/LogRetentionupgrade/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}}}},"LogGroup${Token[TOKEN.237]}upgrade":{"id":"LogGroup${Token[TOKEN.237]}upgrade","path":"MosaicDatabaseStack/Database/LogGroup${Token[TOKEN.237]}upgrade","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}}}},"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a":{"id":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a","path":"MosaicDatabaseStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Code":{"id":"Code","path":"MosaicDatabaseStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.219.0"},"children":{"Stage":{"id":"Stage","path":"MosaicDatabaseStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.219.0"}},"AssetBucket":{"id":"AssetBucket","path":"MosaicDatabaseStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.219.0","metadata":[]}}}},"ServiceRole":{"id":"ServiceRole","path":"MosaicDatabaseStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"MosaicDatabaseStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"MosaicDatabaseStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MosaicDatabaseStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicDatabaseStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["logs:DeleteRetentionPolicy","logs:PutRetentionPolicy"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB","roles":[{"Ref":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"}]}}}}}}},"Resource":{"id":"Resource","path":"MosaicDatabaseStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}}}},"CoreApiSecretsAccessRole":{"id":"CoreApiSecretsAccessRole","path":"MosaicDatabaseStack/CoreApiSecretsAccessRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportCoreApiSecretsAccessRole":{"id":"ImportCoreApiSecretsAccessRole","path":"MosaicDatabaseStack/CoreApiSecretsAccessRole/ImportCoreApiSecretsAccessRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"MosaicDatabaseStack/CoreApiSecretsAccessRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRoleWithWebIdentity","Condition":{"StringEquals":{"oidc.eks.us-east-1.amazonaws.com/id/D491975E1999961E7BBAAE1A77332FBA:sub":"system:serviceaccount:mosaic-prod:core-api-secrets-sa","oidc.eks.us-east-1.amazonaws.com/id/D491975E1999961E7BBAAE1A77332FBA:aud":"sts.amazonaws.com"}},"Effect":"Allow","Principal":{"Federated":"arn:aws:iam::033691785857:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/D491975E1999961E7BBAAE1A77332FBA"}}],"Version":"2012-10-17"},"description":"IAM role for core-api to access database secrets and send emails via IRSA","policies":[{"policyName":"SESEmailSendPolicy","policyDocument":{"Statement":[{"Action":["ses:GetSendQuota","ses:GetSendStatistics","ses:ListVerifiedEmailAddresses","ses:SendEmail","ses:SendRawEmail"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"}}],"roleName":"mosaic-prod-core-api-secrets-role"}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MosaicDatabaseStack/CoreApiSecretsAccessRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicDatabaseStack/CoreApiSecretsAccessRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["secretsmanager:DescribeSecret","secretsmanager:GetSecretValue"],"Effect":"Allow","Resource":{"Ref":"DatabaseSecret86DBB7B3"}}],"Version":"2012-10-17"},"policyName":"CoreApiSecretsAccessRoleDefaultPolicy634CAD7A","roles":[{"Ref":"CoreApiSecretsAccessRoleA08814AC"}]}}}}}}},"DatabaseEndpoint":{"id":"DatabaseEndpoint","path":"MosaicDatabaseStack/DatabaseEndpoint","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"DatabasePort":{"id":"DatabasePort","path":"MosaicDatabaseStack/DatabasePort","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"DatabaseName":{"id":"DatabaseName","path":"MosaicDatabaseStack/DatabaseName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"DatabaseSecretArn":{"id":"DatabaseSecretArn","path":"MosaicDatabaseStack/DatabaseSecretArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"DatabaseSecurityGroupId":{"id":"DatabaseSecurityGroupId","path":"MosaicDatabaseStack/DatabaseSecurityGroupId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"CoreApiSecretsRoleArn":{"id":"CoreApiSecretsRoleArn","path":"MosaicDatabaseStack/CoreApiSecretsRoleArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"EstimatedMonthlyCost":{"id":"EstimatedMonthlyCost","path":"MosaicDatabaseStack/EstimatedMonthlyCost","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"UpgradePath":{"id":"UpgradePath","path":"MosaicDatabaseStack/UpgradePath","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"MosaicDatabaseStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"MosaicDatabaseStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"MosaicDatabaseStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.219.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"MosaicDatabaseStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.219.0"}}}},"MosaicStagingResourcesStack":{"id":"MosaicStagingResourcesStack","path":"MosaicStagingResourcesStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.219.0"},"children":{"StagingMediaBucket":{"id":"StagingMediaBucket","path":"MosaicStagingResourcesStack/StagingMediaBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingMediaBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"bucketName":"mosaic-staging-media-033691785857","corsConfiguration":{"corsRules":[{"maxAge":3000,"allowedHeaders":["*"],"allowedMethods":["GET","PUT","POST","DELETE"],"allowedOrigins":["https://stage.mosaiclife.me","https://stage-api.mosaiclife.me","https://*.mosaiclife.me","http://localhost:5173"],"exposedHeaders":["ETag"]}]},"lifecycleConfiguration":{"rules":[{"id":"TransitionToIA","status":"Enabled","transitions":[{"storageClass":"STANDARD_IA","transitionInDays":90}]},{"id":"DeleteOldVersions","noncurrentVersionExpiration":{"noncurrentDays":30},"status":"Enabled"}]},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"},{"key":"Component","value":"Storage"},{"key":"Environment","value":"staging"}],"versioningConfiguration":{"status":"Enabled"}}}},"Policy":{"id":"Policy","path":"MosaicStagingResourcesStack/StagingMediaBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingMediaBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"StagingMediaBucket0162AB43"},"policyDocument":{"Statement":[{"Action":"s3:*","Condition":{"Bool":{"aws:SecureTransport":"false"}},"Effect":"Deny","Principal":{"AWS":"*"},"Resource":[{"Fn::GetAtt":["StagingMediaBucket0162AB43","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["StagingMediaBucket0162AB43","Arn"]},"/*"]]}]},{"Action":["s3:DeleteObject*","s3:GetBucket*","s3:List*","s3:PutBucketPolicy"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["StagingMediaBucket0162AB43","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["StagingMediaBucket0162AB43","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"MosaicStagingResourcesStack/StagingMediaBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.219.0","metadata":[]},"children":{"Default":{"id":"Default","path":"MosaicStagingResourcesStack/StagingMediaBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}}}}}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"MosaicStagingResourcesStack/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.219.0"},"children":{"Staging":{"id":"Staging","path":"MosaicStagingResourcesStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.219.0"}},"Role":{"id":"Role","path":"MosaicStagingResourcesStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}},"Handler":{"id":"Handler","path":"MosaicStagingResourcesStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}}}},"StagingBackupBucket":{"id":"StagingBackupBucket","path":"MosaicStagingResourcesStack/StagingBackupBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingBackupBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"bucketName":"mosaic-staging-backups-033691785857","lifecycleConfiguration":{"rules":[{"expirationInDays":30,"id":"ExpireOldBackups","status":"Enabled"}]},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"},{"key":"Component","value":"Storage"},{"key":"Environment","value":"staging"}],"versioningConfiguration":{"status":"Enabled"}}}},"Policy":{"id":"Policy","path":"MosaicStagingResourcesStack/StagingBackupBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingBackupBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"StagingBackupBucket996D727B"},"policyDocument":{"Statement":[{"Action":"s3:*","Condition":{"Bool":{"aws:SecureTransport":"false"}},"Effect":"Deny","Principal":{"AWS":"*"},"Resource":[{"Fn::GetAtt":["StagingBackupBucket996D727B","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["StagingBackupBucket996D727B","Arn"]},"/*"]]}]},{"Action":["s3:DeleteObject*","s3:GetBucket*","s3:List*","s3:PutBucketPolicy"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["StagingBackupBucket996D727B","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["StagingBackupBucket996D727B","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"MosaicStagingResourcesStack/StagingBackupBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.219.0","metadata":[]},"children":{"Default":{"id":"Default","path":"MosaicStagingResourcesStack/StagingBackupBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}}}}}},"StagingSessionSecret":{"id":"StagingSessionSecret","path":"MosaicStagingResourcesStack/StagingSessionSecret","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.Secret","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingSessionSecret/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_secretsmanager.CfnSecret","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SecretsManager::Secret","aws:cdk:cloudformation:props":{"description":"Session secret key for staging environment","generateSecretString":{"secretStringTemplate":"{}","generateStringKey":"secret-key","excludePunctuation":true,"passwordLength":64},"name":"mosaic/staging/session/secret-key","tags":[{"key":"Component","value":"Security"},{"key":"Environment","value":"staging"}]}}}}},"StagingDomainEventsTopic":{"id":"StagingDomainEventsTopic","path":"MosaicStagingResourcesStack/StagingDomainEventsTopic","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingDomainEventsTopic/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{"displayName":"Mosaic Life Staging Domain Events","topicName":"mosaic-staging-domain-events"}}}}},"StagingEventsDLQ":{"id":"StagingEventsDLQ","path":"MosaicStagingResourcesStack/StagingEventsDLQ","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingEventsDLQ/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"messageRetentionPeriod":604800,"queueName":"mosaic-staging-events-dlq"}}}}},"StagingEventsQueue":{"id":"StagingEventsQueue","path":"MosaicStagingResourcesStack/StagingEventsQueue","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingEventsQueue/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"queueName":"mosaic-staging-events","redrivePolicy":{"deadLetterTargetArn":{"Fn::GetAtt":["StagingEventsDLQF68990AE","Arn"]},"maxReceiveCount":3},"visibilityTimeout":300}}},"Policy":{"id":"Policy","path":"MosaicStagingResourcesStack/StagingEventsQueue/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.QueuePolicy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingEventsQueue/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueuePolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::QueuePolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"sqs:SendMessage","Condition":{"ArnEquals":{"aws:SourceArn":{"Ref":"StagingDomainEventsTopic476D4C5C"}}},"Effect":"Allow","Principal":{"Service":"sns.amazonaws.com"},"Resource":{"Fn::GetAtt":["StagingEventsQueue2360CE9E","Arn"]}}],"Version":"2012-10-17"},"queues":[{"Ref":"StagingEventsQueue2360CE9E"}]}}}}},"MosaicStagingResourcesStackStagingDomainEventsTopic00B7BCF7":{"id":"MosaicStagingResourcesStackStagingDomainEventsTopic00B7BCF7","path":"MosaicStagingResourcesStack/StagingEventsQueue/MosaicStagingResourcesStackStagingDomainEventsTopic00B7BCF7","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Subscription","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingEventsQueue/MosaicStagingResourcesStackStagingDomainEventsTopic00B7BCF7/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnSubscription","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Subscription","aws:cdk:cloudformation:props":{"endpoint":{"Fn::GetAtt":["StagingEventsQueue2360CE9E","Arn"]},"protocol":"sqs","topicArn":{"Ref":"StagingDomainEventsTopic476D4C5C"}}}}}}}},"StagingCoreApiRole":{"id":"StagingCoreApiRole","path":"MosaicStagingResourcesStack/StagingCoreApiRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.219.0","metadata":[]},"children":{"ImportStagingCoreApiRole":{"id":"ImportStagingCoreApiRole","path":"MosaicStagingResourcesStack/StagingCoreApiRole/ImportStagingCoreApiRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.219.0","metadata":[]}},"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingCoreApiRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Federated":"arn:aws:iam::033691785857:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/D491975E1999961E7BBAAE1A77332FBA"}}],"Version":"2012-10-17"},"description":"IAM role for staging core-api service in EKS (S3, Secrets, SES)","policies":[{"policyName":"SESEmailSendPolicy","policyDocument":{"Statement":[{"Action":["ses:GetSendQuota","ses:GetSendStatistics","ses:ListVerifiedEmailAddresses","ses:SendEmail","ses:SendRawEmail"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"}}],"roleName":"mosaic-staging-core-api-role","tags":[{"key":"Component","value":"IAM"},{"key":"Environment","value":"staging"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MosaicStagingResourcesStack/StagingCoreApiRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.219.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MosaicStagingResourcesStack/StagingCoreApiRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.219.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:Abort*","s3:DeleteObject*","s3:GetBucket*","s3:GetObject*","s3:List*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["StagingBackupBucket996D727B","Arn"]},{"Fn::GetAtt":["StagingMediaBucket0162AB43","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["StagingBackupBucket996D727B","Arn"]},"/*"]]},{"Fn::Join":["",[{"Fn::GetAtt":["StagingMediaBucket0162AB43","Arn"]},"/*"]]}]},{"Action":"secretsmanager:GetSecretValue","Effect":"Allow","Resource":"arn:aws:secretsmanager:us-east-1:033691785857:secret:mosaic/staging/*","Sid":"AllowStagingSecretsAccess"},{"Action":"sns:Publish","Effect":"Allow","Resource":{"Ref":"StagingDomainEventsTopic476D4C5C"}},{"Action":["sqs:ChangeMessageVisibility","sqs:DeleteMessage","sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:ReceiveMessage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["StagingEventsQueue2360CE9E","Arn"]}},{"Action":["bedrock:InvokeModel","bedrock:InvokeModelWithResponseStream"],"Effect":"Allow","Resource":["arn:aws:bedrock:us-east-1:033691785857:inference-profile/us.anthropic.*","arn:aws:bedrock:us-east-1::foundation-model/anthropic.*","arn:aws:bedrock:us-east-2:033691785857:inference-profile/us.anthropic.*","arn:aws:bedrock:us-east-2::foundation-model/anthropic.*","arn:aws:bedrock:us-west-2:033691785857:inference-profile/us.anthropic.*","arn:aws:bedrock:us-west-2::foundation-model/anthropic.*"],"Sid":"AllowBedrockInvoke"}],"Version":"2012-10-17"},"policyName":"StagingCoreApiRoleDefaultPolicy6315AD05","roles":[{"Ref":"StagingCoreApiRole3AA7529C"}]}}}}}}},"StagingMediaBucketName":{"id":"StagingMediaBucketName","path":"MosaicStagingResourcesStack/StagingMediaBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"StagingBackupBucketName":{"id":"StagingBackupBucketName","path":"MosaicStagingResourcesStack/StagingBackupBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"StagingCoreApiRoleArn":{"id":"StagingCoreApiRoleArn","path":"MosaicStagingResourcesStack/StagingCoreApiRoleArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"StagingSessionSecretArn":{"id":"StagingSessionSecretArn","path":"MosaicStagingResourcesStack/StagingSessionSecretArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"StagingDomainEventsTopicArn":{"id":"StagingDomainEventsTopicArn","path":"MosaicStagingResourcesStack/StagingDomainEventsTopicArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.219.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"MosaicStagingResourcesStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"MosaicStagingResourcesStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.219.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"MosaicStagingResourcesStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.219.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"MosaicStagingResourcesStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.219.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}